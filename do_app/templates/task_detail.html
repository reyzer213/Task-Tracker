{% extends 'base.html' %}

{% block content %}
<h2>{{ task.title }}</h2>
<p>{{ task.description }}</p>
<p>Status: {{ task.get_status_display }}</p>
<p>Priority: {{ task.get_priority_display }}</p>
<p>Due Date: {{ task.due_date }}</p>

<h3>Comments</h3>
<ul>
    {% for comment in comments %}
    <li>
        <strong>{{ comment.author }}:</strong> {{ comment.text }} <em>on {{ comment.created_at }}</em>

        <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–æ–≥–æ —Ñ–∞–π–ª—É -->
    {% if comment.file %}
        <p>Attached file: <a href="{{ comment.file.url }}">{{ comment.file.name }}</a></p>
        {% if comment.file.name|slice:"-4:" == ".jpg" or comment.file.name|slice:"-4:" == ".png" %}
            <img src="{{ comment.file.url }}" alt="Image" style="max-width: 300px;">
        {% elif comment.file.name|slice:"-4:" == ".pdf" %}
            <p>PDF file attached: <a href="{{ comment.file.url }}" target="_blank">View PDF</a></p>
        {% elif comment.file.name|slice:"-4:" == ".mp4" %}
            <video controls style="max-width: 300px;">
                <source src="{{ comment.file.url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        {% endif %}
    {% endif %}

        <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
        {% if comment.author == user %}
            <a href="{% url 'comment_edit' comment.id %}" class="btn btn-sm btn-warning">Edit</a>
            <a href="{% url 'comment_delete' comment.id %}" class="btn btn-sm btn-danger">Delete</a>
        {% endif %}

        <!-- –§–æ—Ä–º–∞ –¥–ª—è –ª–∞–π–∫—É–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
        <form action="{% url 'like_comment' comment.id %}" method="post" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-link">
                üëç {{ comment.likes.count }} Like{{ comment.likes.count|pluralize }}
            </button>
        </form>
    </li>
    {% empty %}
    <li>No comments yet.</li>
    {% endfor %}
</ul>

<h4>Add a comment:</h4>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Add Comment</button>
</form>

<a href="{% url 'task_list' %}" class="btn btn-secondary mt-3">Back to Task List</a>
{% endblock %}
